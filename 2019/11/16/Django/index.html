<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="FaSv6sE3Ke0fp0o-99wCK7Sq8n3EE6kD7rRMsKFNdL8">
  <meta name="msvalidate.01" content="141965EBBA612424B0BB633973389BBC">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"groot-guo.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.19.2","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Django 框架初步使用，简单流程记录">
<meta property="og:type" content="article">
<meta property="og:title" content="Django 框架了解">
<meta property="og:url" content="https://groot-guo.github.io/2019/11/16/Django/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="Django 框架初步使用，简单流程记录">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-11-16T00:00:00.000Z">
<meta property="article:modified_time" content="2019-11-16T00:00:00.000Z">
<meta property="article:author" content="genyuan">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://groot-guo.github.io/2019/11/16/Django/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://groot-guo.github.io/2019/11/16/Django/","path":"2019/11/16/Django/","title":"Django 框架了解"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Django 框架了解 | 博客</title>
  



  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{&quot;token&quot;: &quot;7e720c05456141d683df1d166f937ad1&quot;}'></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Groot 的博客笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#django"><span class="nav-number">1.</span> <span class="nav-text"> Django</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#url%E6%8E%A7%E5%88%B6%E5%99%A8%E8%B7%AF%E7%94%B1"><span class="nav-number">1.0.1.</span> <span class="nav-text"> url控制器（路由）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="nav-number">1.0.2.</span> <span class="nav-text"> 视图函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="nav-number">1.0.3.</span> <span class="nav-text"> 模板语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csrf%E6%A0%87%E7%AD%BE"><span class="nav-number">1.0.4.</span> <span class="nav-text"> csrf标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="nav-number">1.0.5.</span> <span class="nav-text"> 模板继承</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#orm"><span class="nav-number">1.1.</span> <span class="nav-text"> ORM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="nav-number">1.1.1.</span> <span class="nav-text"> 数据库迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text"> 操作数据的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">1.1.2.1.</span> <span class="nav-text"> 单表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text"> 单表查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text"> 模糊查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%B7%BB%E5%8A%A0"><span class="nav-number">1.1.2.1.3.</span> <span class="nav-text"> 单表添加</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E5%88%A0%E9%99%A4"><span class="nav-number">1.1.2.1.4.</span> <span class="nav-text"> 单表删除</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E4%BF%AE%E6%94%B9"><span class="nav-number">1.1.2.1.5.</span> <span class="nav-text"> 单表修改</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">1.1.2.2.</span> <span class="nav-text"> 多表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text"> 添加</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text"> 修改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.1.2.2.3.</span> <span class="nav-text"> 基于对象的跨表查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%84%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%9F%BA%E4%BA%8Ejoin%E5%AE%9E%E7%8E%B0%E7%9A%84"><span class="nav-number">1.1.2.2.4.</span> <span class="nav-text"> 基于双下划线的跨表查询（基于join实现的）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%88%86%E7%BB%84"><span class="nav-number">1.1.2.2.5.</span> <span class="nav-text"> 聚合分组</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.2.3.</span> <span class="nav-text"> 聚合函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.1.2.4.</span> <span class="nav-text"> 分组查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#f%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.3.</span> <span class="nav-text"> F函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.4.</span> <span class="nav-text"> Q函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.5.</span> <span class="nav-text"> 新的数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.1.6.</span> <span class="nav-text"> 静态文件设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.1.7.</span> <span class="nav-text"> 中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forms%E7%BB%84%E4%BB%B6"><span class="nav-number">1.1.8.</span> <span class="nav-text"> forms组件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#crm"><span class="nav-number">2.</span> <span class="nav-text"> CRM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">2.0.1.</span> <span class="nav-text"> 表结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pep8%E8%A7%84%E8%8C%83"><span class="nav-number">3.</span> <span class="nav-text"> PEP8规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%8C%85%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="nav-number">3.0.1.</span> <span class="nav-text"> 导包的顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">3.0.2.</span> <span class="nav-text"> 注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="nav-number">3.0.3.</span> <span class="nav-text"> 命名规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B9%A6%E5%86%99%E6%96%B9%E5%BC%8F"><span class="nav-number">3.0.4.</span> <span class="nav-text"> 书写方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rbac%E7%BB%84%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text"> RBAC组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E8%8F%9C%E5%8D%95%E6%9D%83%E9%99%90"><span class="nav-number">3.1.0.1.</span> <span class="nav-text"> 动态显示菜单权限</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#queryset"><span class="nav-number">3.2.</span> <span class="nav-text"> Queryset</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#drfdjango-rest-framework"><span class="nav-number">3.3.</span> <span class="nav-text"> DRF（django rest framework）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">3.4.</span> <span class="nav-text"> 解析器组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#drf%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">3.4.1.</span> <span class="nav-text"> DRF序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mixins-%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96"><span class="nav-number">3.4.2.</span> <span class="nav-text"> Mixins 进行接口优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-generics-%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%8F%A3%E9%80%BB%E8%BE%91%E4%BC%98%E5%8C%96"><span class="nav-number">3.4.3.</span> <span class="nav-text"> 使用 generics 进行接口逻辑优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8viewset%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%8F%A3%E9%80%BB%E8%BE%91%E4%BC%98%E5%8C%96"><span class="nav-number">3.4.4.</span> <span class="nav-text"> 使用viewset进行接口逻辑优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#django%E4%B8%8B%E7%9A%84%E8%A1%A8contentype%E8%A1%A8"><span class="nav-number">3.5.</span> <span class="nav-text"> Django下的表contentype表：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E9%92%A5%E7%A7%81%E9%92%A5"><span class="nav-number">3.6.</span> <span class="nav-text"> 公钥私钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83"><span class="nav-number">3.7.</span> <span class="nav-text"> 支付宝沙箱环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#django-admin%E6%BA%90%E7%A0%81"><span class="nav-number">3.8.</span> <span class="nav-text"> Django admin源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie%E5%92%8Csession%E5%8C%BA%E5%88%AB"><span class="nav-number">3.9.</span> <span class="nav-text"> Cookie和session区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session"><span class="nav-number">3.10.</span> <span class="nav-text"> session</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="genyuan"
      src="/images/avatar.PNG">
  <p class="site-author-name" itemprop="name">genyuan</p>
  <div class="site-description" itemprop="description">个人笔记博客记录</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dyb290LWd1bw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;groot-guo"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <a href="/genyuan.guo@gmail.com" title="E-Mail → genyuan.guo@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <span class="exturl" data-url="aHR0cHM6Ly9leGFtcGxlLmNvbQ==" title="https:&#x2F;&#x2F;example.com">Title</span>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://groot-guo.github.io/2019/11/16/Django/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.PNG">
      <meta itemprop="name" content="genyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="个人笔记博客记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Django 框架了解 | 博客">
      <meta itemprop="description" content="Django 框架初步使用，简单流程记录">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Django 框架了解
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-16 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-16T00:00:00+00:00">2019-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IT%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">IT技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IT%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">后端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IT%E6%8A%80%E6%9C%AF/%E5%90%8E%E7%AB%AF/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">Django 框架初步使用，简单流程记录</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="django"><a class="markdownIt-Anchor" href="#django"></a> Django</h1>
<p>项目与应用的关系</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject 项目名称</span><br></pre></td></tr></table></figure>
<p>创建应用</p>
<p>python <span class="exturl" data-url="aHR0cDovL21hbmFnZS5weQ==">manage.py<i class="fa fa-external-link-alt"></i></span> startapp 视图函数</p>
<p>启动项目</p>
<p>python <span class="exturl" data-url="aHR0cDovL21hbmFnZS5weQ==">manage.py<i class="fa fa-external-link-alt"></i></span> runserver IP:PORT</p>
<p>(默认本机端口8080)</p>
<h3 id="url控制器路由"><a class="markdownIt-Anchor" href="#url控制器路由"></a> url控制器（路由）</h3>
<ol>
<li>简单分组</li>
<li>有名分组</li>
<li>分发</li>
<li>反向解析</li>
</ol>
<h3 id="视图函数"><a class="markdownIt-Anchor" href="#视图函数"></a> 视图函数</h3>
<p>request（请求对象）</p>
<p>response（响应对象）</p>
<p>redict</p>
<h3 id="模板语法"><a class="markdownIt-Anchor" href="#模板语法"></a> 模板语法</h3>
<p>渲染变量  <code>&#123;&#123;&#125;&#125;</code> locals（）能全部传进去</p>
<ul>
<li>深度查询：句点符</li>
<li>filter ： 过滤器</li>
</ul>
<p>渲染标签  <code>&#123;%%&#125;</code></p>
<ul>
<li>
<p>for</p>
<p><code>&#123;% for i in book %&#125; </code></p>
</li>
<li>
<p>if</p>
</li>
</ul>
<h3 id="csrf标签"><a class="markdownIt-Anchor" href="#csrf标签"></a> csrf标签</h3>
<p>需要在 form 表单中添加 <code>&#123;% csrf_token %&#125;</code></p>
<h3 id="模板继承"><a class="markdownIt-Anchor" href="#模板继承"></a> 模板继承</h3>
<p>extand</p>
<h2 id="orm"><a class="markdownIt-Anchor" href="#orm"></a> ORM</h2>
<p>建立在pymysql之上，避免书写sql语句</p>
<p>更加高效的使用</p>
<p>在设置中修改引擎即可，无需重新写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;bms&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;ggy&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据库迁移"><a class="markdownIt-Anchor" href="#数据库迁移"></a> 数据库迁移</h3>
<p>python <span class="exturl" data-url="aHR0cDovL21hbmFnZS5weQ==">manage.py<i class="fa fa-external-link-alt"></i></span> makemigrations</p>
<p>python <span class="exturl" data-url="aHR0cDovL21hbmFnZS5weQ==">manage.py<i class="fa fa-external-link-alt"></i></span> migrate</p>
<h3 id="操作数据的方式"><a class="markdownIt-Anchor" href="#操作数据的方式"></a> 操作数据的方式</h3>
<h4 id="单表操作"><a class="markdownIt-Anchor" href="#单表操作"></a> 单表操作</h4>
<h5 id="单表查询"><a class="markdownIt-Anchor" href="#单表查询"></a> 单表查询</h5>
<ol>
<li>all（） 方法：返回QuerySet类型</li>
<li>filter（）方法：返回QuerySet类型，要输入创建的配配置</li>
<li>get（）方法：返回 model对象</li>
<li>first（）last（）方法：QuerySet调用 ，返回model对象</li>
<li>exclude（）方法：返回QuerySet类型</li>
<li>order_by（）方法：排序，QuerySet调用，返回QuerySet类型</li>
<li>count（）方法：数数，QuerySet调用</li>
<li>reverse（）方法：QuerySet调用，返回也是QuerySet类型</li>
<li>exists（）：QuerySet调用，返回也是布尔类型</li>
<li>values（）：由queryset对象调用,返回值是queryset</li>
<li>values_list：由queryset对象调用,返回值是queryset</li>
</ol>
<h5 id="模糊查询"><a class="markdownIt-Anchor" href="#模糊查询"></a> 模糊查询</h5>
<p>双下划线</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Book.objects.<span class="built_in">filter</span>(price__in=[<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>])</span><br><span class="line"><span class="comment">#查价格等于100，200，300</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__gt=<span class="number">100</span>)</span><br><span class="line"><span class="comment">#查询价格大于100</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__lt=<span class="number">100</span>)</span><br><span class="line"><span class="comment">#查询价格小于100</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(price__range=[<span class="number">100</span>,<span class="number">200</span>])</span><br><span class="line"><span class="comment">#查询价格在100-200</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__contains=<span class="string">&quot;python&quot;</span>)</span><br><span class="line"><span class="comment"># 查询是python的书籍</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__icontains=<span class="string">&quot;python&quot;</span>)</span><br><span class="line"><span class="comment"># 查询包含python的书籍</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(title__startswith=<span class="string">&quot;py&quot;</span>)</span><br><span class="line"><span class="comment"># 查询以 py 开头</span></span><br><span class="line">Book.objects.<span class="built_in">filter</span>(pub_date__year=<span class="number">2012</span>)</span><br><span class="line"><span class="comment"># 查询以2012年开头</span></span><br><span class="line"></span><br><span class="line">setting.py</span><br><span class="line">USE_TZ = <span class="literal">True</span> <span class="comment">#时间模块</span></span><br></pre></td></tr></table></figure>
<h5 id="单表添加"><a class="markdownIt-Anchor" href="#单表添加"></a> 单表添加</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一</span></span><br><span class="line">Book(titile)</span><br><span class="line">boo.save</span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">book.objects.create()</span><br><span class="line"><span class="comment">#注意create 方法返回当前生成表的记录对象</span></span><br></pre></td></tr></table></figure>
<h5 id="单表删除"><a class="markdownIt-Anchor" href="#单表删除"></a> 单表删除</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.delete()</span><br></pre></td></tr></table></figure>
<h5 id="单表修改"><a class="markdownIt-Anchor" href="#单表修改"></a> 单表修改</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.update</span><br></pre></td></tr></table></figure>
<h4 id="多表操作"><a class="markdownIt-Anchor" href="#多表操作"></a> 多表操作</h4>
<h5 id="添加"><a class="markdownIt-Anchor" href="#添加"></a> 添加</h5>
<p>一对多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pub_obj=Publish.objects.filter(name=&quot;橙子出版社&quot;).first()</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># book=Book.objects.create(</span></span><br><span class="line">   <span class="comment">#     title=&quot;python&quot;,</span></span><br><span class="line">   <span class="comment">#     price=120,</span></span><br><span class="line">   <span class="comment">#     pub_date=&quot;2012-12-12&quot;,</span></span><br><span class="line">   <span class="comment">#     publish_id=1,</span></span><br><span class="line">   <span class="comment">#     #publish=pub_obj</span></span><br><span class="line">   <span class="comment">#</span></span><br><span class="line">   <span class="comment"># )</span></span><br></pre></td></tr></table></figure>
<p>多对多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1</span></span><br><span class="line"> <span class="comment"># alex=Author.objects.filter(name=&quot;alex&quot;).first()</span></span><br><span class="line"> <span class="comment"># egon=Author.objects.filter(name=&quot;egon&quot;).first()</span></span><br><span class="line"> <span class="comment"># book.authors.add(alex,egon)</span></span><br><span class="line"> <span class="comment"># 方式2：</span></span><br><span class="line"> <span class="comment"># book.authors.add(1,2)</span></span><br><span class="line"> <span class="comment"># 方式3：</span></span><br><span class="line"> <span class="comment"># book.authors.add(*[1,2])</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一对一</p>
<p>如同</p>
<h5 id="修改"><a class="markdownIt-Anchor" href="#修改"></a> 修改</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### 解除再绑定</span></span><br><span class="line">   book = Book.objects.<span class="built_in">filter</span>(nid=<span class="number">3</span>).first()</span><br><span class="line">   book.authors.clear()</span><br><span class="line">   book.authors.add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">   book.authors.<span class="built_in">set</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h5 id="基于对象的跨表查询"><a class="markdownIt-Anchor" href="#基于对象的跨表查询"></a> 基于对象的跨表查询</h5>
<p>一对多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 一对多 ##########</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    正向查询：关联属性所在的表查询关联表记录</span></span><br><span class="line"><span class="string">    反向查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ----正向查询按字段：book.publish</span></span><br><span class="line"><span class="string">    Book------------------------------------&gt;Publish</span></span><br><span class="line"><span class="string">         &lt;-----------------------------------</span></span><br><span class="line"><span class="string">          反向查询表名小写_set.all()：pub_obj.book_set.all()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>多对多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 多对多 ##########</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                正向查询按字段 book.authors.all()</span></span><br><span class="line"><span class="string">       Book  --------------------------------------&gt;Author</span></span><br><span class="line"><span class="string">             &lt;--------------------------------------</span></span><br><span class="line"><span class="string">                反向查询按表名小写_set.all()： alex.book_set.all()</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>一对一</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 一对一 ##########</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                     正常查询安字段：alex.ad</span></span><br><span class="line"><span class="string">        Author -----------------------------------------&gt; AuthorDetail</span></span><br><span class="line"><span class="string">               &lt;------------------------------------------</span></span><br><span class="line"><span class="string">                     反向查询按表名小写  ad.author</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="基于双下划线的跨表查询基于join实现的"><a class="markdownIt-Anchor" href="#基于双下划线的跨表查询基于join实现的"></a> 基于双下划线的跨表查询（基于join实现的）</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># KEY：正向查询按字段，反向查询按表明小写</span></span><br><span class="line"><span class="comment"># 手机号以110开头的作者出版过的所有书籍名称以及出版社名称</span></span><br><span class="line"><span class="comment"># 方式1:</span></span><br><span class="line"><span class="comment">#ret=Author.objects.filter(ad__tel__startswith=110).values_list(&quot;book__title&quot;,&quot;book__publish__name&quot;)</span></span><br><span class="line"><span class="comment"># print(ret)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2：</span></span><br><span class="line"><span class="comment">#ret=AuthorDetail.objects.filter(tel__startswith=110).values(&quot;author__book__title&quot;,&quot;author__book__publish__name&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # 方式3：</span></span><br><span class="line"><span class="comment">#ret=Book.objects.filter(authors__ad__tel__startswith=110).values(&quot;title&quot;,&quot;publish__name&quot;)</span></span><br></pre></td></tr></table></figure>
<h5 id="聚合分组"><a class="markdownIt-Anchor" href="#聚合分组"></a> 聚合分组</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合</span></span><br><span class="line"> <span class="comment"># 查询所有书籍的平均价格</span></span><br><span class="line"> <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg,Max,Sum,Min,Count</span><br><span class="line"> <span class="comment"># ret=Book.objects.all().aggregate(priceAvg=Avg(&quot;price&quot;))</span></span><br><span class="line"> <span class="comment"># print(ret) # &#123;&#x27;priceAvg&#x27;: 142.0&#125;</span></span><br><span class="line"> <span class="comment"># # 查询所有书籍的个数</span></span><br><span class="line"> <span class="comment"># ret=Book.objects.all().aggregate(c=Count(1))</span></span><br><span class="line"> <span class="comment"># print(ret) # &#123;&#x27;c&#x27;: 4&#125;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># 跨表分组查询</span></span><br><span class="line"> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> select app01_publish.name,COUNT(1) from app01_book INNER JOIN app01_publish ON app01_book.publish_id=app01_publish.nid</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">                          GROUP BY app01_publish.nid</span></span><br><span class="line"><span class="string"> &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查询每一个出版社的名称以及对应的书籍平均价格</span></span><br><span class="line"> <span class="comment"># ret=Publish.objects.values(&quot;name&quot;,&quot;email&quot;).annotate(avg_price=Avg(&quot;book__price&quot;))</span></span><br><span class="line"> <span class="comment"># print(ret) # &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;苹果出版社&#x27;, &#x27;avg_price&#x27;: 117.0&#125;, &#123;&#x27;name&#x27;: &#x27;橙子出版社&#x27;, &#x27;avg_price&#x27;: 112.0&#125;, &#123;&#x27;name&#x27;: &#x27;西瓜出版社&#x27;, &#x27;avg_price&#x27;: 222.0&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查询每一个作者的名字以及出版的书籍的最高价格</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># ret=Author.objects.values(&quot;pk&quot;,&quot;name&quot;).annotate(max_price=Max(&quot;book__price&quot;))</span></span><br><span class="line"> <span class="comment"># print(ret)</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># 查询每一个书籍的名称以及对应的作者的个数</span></span><br><span class="line"> ret=Book.objects.values(<span class="string">&quot;title&quot;</span>).annotate(c=Count(<span class="string">&quot;authors&quot;</span>))</span><br><span class="line"> <span class="built_in">print</span>(ret) <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;python&#x27;, &#x27;authors__count&#x27;: 2&#125;, &#123;&#x27;title&#x27;: &#x27;linux&#x27;, &#x27;authors__count&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;go&#x27;, &#x27;authors__count&#x27;: 1&#125;, &#123;&#x27;title&#x27;: &#x27;java&#x27;, &#x27;authors__count&#x27;: 0&#125;]&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="聚合函数"><a class="markdownIt-Anchor" href="#聚合函数"></a> 聚合函数</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg,Max,Sum,Min,Count</span><br><span class="line">.aggregate(Count(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<h4 id="分组查询"><a class="markdownIt-Anchor" href="#分组查询"></a> 分组查询</h4>
<p>单表分组查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.annotate()前面values 哪一个字段就按哪一个字段分组</span><br></pre></td></tr></table></figure>
<p>跨表分组查询</p>
<h3 id="f函数"><a class="markdownIt-Anchor" href="#f函数"></a> F函数</h3>
<h3 id="q函数"><a class="markdownIt-Anchor" href="#q函数"></a> Q函数</h3>
<h3 id="新的数据类型"><a class="markdownIt-Anchor" href="#新的数据类型"></a> 新的数据类型</h3>
<p>QuerySet</p>
<p><code>[obj1，obj2]</code></p>
<h3 id="静态文件设置"><a class="markdownIt-Anchor" href="#静态文件设置"></a> 静态文件设置</h3>
<p>配置setting</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;static&quot;</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>###</code></p>
<p>如果url 只差一个/ django会加</p>
<p>append_SLASH = true 自动补 / 重定向301</p>
<h3 id="中间件"><a class="markdownIt-Anchor" href="#中间件"></a> 中间件</h3>
<p>middleware</p>
<h3 id="forms组件"><a class="markdownIt-Anchor" href="#forms组件"></a> forms组件</h3>
<p>源码解析</p>
<p>钩子的应用</p>
<h1 id="crm"><a class="markdownIt-Anchor" href="#crm"></a> CRM</h1>
<h3 id="表结构"><a class="markdownIt-Anchor" href="#表结构"></a> 表结构</h3>
<p>modelForm</p>
<p>CBV 与 FBV</p>
<p>FBV ----- function based view</p>
<p>CBV ----- class based view</p>
<p>视图函数</p>
<p>自定义分页</p>
<p>dispatch分发</p>
<p>创建超级用户</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createsuperuser</span><br></pre></td></tr></table></figure>
<h1 id="pep8规范"><a class="markdownIt-Anchor" href="#pep8规范"></a> PEP8规范</h1>
<p>PEP8规范时约束我们在书写 python 时的一种代码规范，在此罗列出一些常用的规范。详细可以区查看官网具体定义。<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kZXYvcGVwcy9wZXAtMDAwOC8=">PEP8规范<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="导包的顺序"><a class="markdownIt-Anchor" href="#导包的顺序"></a> 导包的顺序</h3>
<p>标准库  --&gt; 第三方库   --&gt; 自己的，一共三层，每层之间空开一行</p>
<h3 id="注释"><a class="markdownIt-Anchor" href="#注释"></a> 注释</h3>
<p>注释多行一般采用双引号注释，函数注释，写完双引号 在中间按 Enter  ，可以生成快速注释（在pycharm中），对于注释可以进行详细解释。</p>
<p>单行注释，一般用于局部注释信息，书写时要与 <code># </code>空一格</p>
<h3 id="命名规范"><a class="markdownIt-Anchor" href="#命名规范"></a> 命名规范</h3>
<p>python 中命名规范有两种</p>
<ul>
<li>驼峰式命名</li>
<li>下划线命名</li>
</ul>
<p>驼峰式命名，一般要作用项目名称，或者类名书写</p>
<p>下划线命名一般用于变量或者函数命名，由于变量或者函数的命名表达不清楚时可以使用下划线命名。</p>
<p>特殊变量常量，由于 python 中无法定义常量，一般将常量的命名全部大写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CASE = <span class="number">123</span></span><br></pre></td></tr></table></figure>
<p>模块命名小写，表达不了用下划线隔开</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_user</span><br><span class="line"><span class="keyword">from</span> add_user</span><br></pre></td></tr></table></figure>
<h3 id="书写方式"><a class="markdownIt-Anchor" href="#书写方式"></a> 书写方式</h3>
<p>等号两边都有空格</p>
<p>函数或者类之间相隔两个空行</p>
<p>结束时空一行</p>
<h2 id="rbac组件"><a class="markdownIt-Anchor" href="#rbac组件"></a> RBAC组件</h2>
<p>rbac 组件一般我们用于权限的校验，帮助我们更好的管理用户认证信息，不同的用户权限不同，访问的界面展示也不相同</p>
<p>什么是权限： 一个含有正则表达式的 url</p>
<p>基于 RBAC 设计表关系：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        <span class="comment"># 此处设置 admin 中显示名称</span></span><br><span class="line">        verbose_name = verbose_name_plural = <span class="string">&#x27;用户表&#x27;</span></span><br><span class="line"></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    pwd = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    roles = models.ManyToManyField(to=<span class="string">&#x27;Role&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span>(models.Model):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = verbose_name_plural = <span class="string">&#x27;职位表&#x27;</span></span><br><span class="line"></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    permissions = models.ManyToManyField(to=<span class="string">&#x27;Permission&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Permission</span>(models.Model):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = verbose_name_plural = <span class="string">&#x27;权限表&#x27;</span></span><br><span class="line"></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    url = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">	menu=models.ForeignKey(<span class="string">&quot;Menu&quot;</span>,on_delete=models.CASCADE,null=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Menu</span>(models.Model):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = verbose_name_plural = <span class="string">&#x27;菜单表&#x27;</span></span><br><span class="line">        </span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&#x27;菜单&#x27;</span>)</span><br><span class="line">    icon = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&#x27;图标&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>添加需要的权限信息</p>
<p>任何利用中间件和自定义的模块 传输和获取 当前用户的权限信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过自定义 middleware 模块在 setting 中加入，引入中间件</span></span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse, redirect</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PermissionMiddleWare</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line"></span><br><span class="line">        current_path = request.path</span><br><span class="line">        <span class="comment"># 设置白名单</span></span><br><span class="line">        <span class="keyword">for</span> reg <span class="keyword">in</span> [<span class="string">&#x27;/login/&#x27;</span>, <span class="string">&#x27;/admin/*&#x27;</span>]:</span><br><span class="line">            ret = re.search(reg, current_path)</span><br><span class="line">            <span class="keyword">if</span> ret:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 校验是否登录</span></span><br><span class="line">        user_id = request.session.get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user_id:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 校验权限</span></span><br><span class="line">        permission_list = request.session.get(<span class="string">&quot;permission_list&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> reg <span class="keyword">in</span> permission_list:</span><br><span class="line">            reg = <span class="string">&quot;^%s$&quot;</span> % reg</span><br><span class="line">            ret = re.search(reg, current_path)</span><br><span class="line">            <span class="keyword">if</span> ret:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;无权访问！&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>rbac 自定义模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app1.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initial_sesson</span>(<span class="params">user, request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    功能：将当前登录人的所有权限录入 session 中</span></span><br><span class="line"><span class="string">    :param user:当前登录人</span></span><br><span class="line"><span class="string">    :param request:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 查询当前登录人的所有权限列表</span></span><br><span class="line">    permissions = Role.objects.<span class="built_in">filter</span>(user=user).values(<span class="string">&#x27;permissions__url&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;roles&#x27;</span>, permissions)</span><br><span class="line"></span><br><span class="line">    permissions_list = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> permissions:</span><br><span class="line">        permissions_list.append(item[<span class="string">&#x27;permissions__url&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将当前登录人的权限列表注入 session 中</span></span><br><span class="line">    request.session[<span class="string">&#x27;permission_list&#x27;</span>] = permissions_list</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="动态显示菜单权限"><a class="markdownIt-Anchor" href="#动态显示菜单权限"></a> 动态显示菜单权限</h4>
<p>动态获取显示菜单，注意本次显示是后台操作</p>
<p>需要获取当前用户的权限信息，获取 url 和 是否为菜单，以及所带的 icon 图标。因为设计到传值的问题，于是我们产生了自定过滤器。</p>
<p>首先自定过滤器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># web.py 文件中</span></span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">register =Library()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params"><span class="string">&quot;rbac/menu.html&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 将当前函数的 permission_menu_dict 传给 rbac 的 menu.html</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_menu_styles</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义过滤器</span></span><br><span class="line"><span class="string">    :param request:传入当前用户菜单信息 </span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    permission_menu_dict = request.session.get(<span class="string">&quot;permission_menu_dict&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;permission_menu_dict&quot;</span>,permission_menu_dict)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;permission_menu_dict&quot;</span>:permission_menu_dict&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 menu.html 中书写</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"># menu.html</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;multi-menu&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> item <span class="keyword">in</span> permission_menu_dict.values %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; item.menu_icon &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><span class="template-variable">&#123;&#123; item.menu_title &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              </span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> foo <span class="keyword">in</span> item.children %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; foo.url &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123; foo.title &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>使用自定义的组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left-menu&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-body&quot;</span>&gt;</span></span><br><span class="line">           &#123;% load web %&#125;</span><br><span class="line">           &#123;% get_menu_styles request %&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>整体样图</p>
<h2 id="queryset"><a class="markdownIt-Anchor" href="#queryset"></a> Queryset</h2>
<p>特点：</p>
<ul>
<li>可切片</li>
<li>可迭代</li>
<li>惰性查询</li>
<li>缓存机制</li>
</ul>
<h2 id="drfdjango-rest-framework"><a class="markdownIt-Anchor" href="#drfdjango-rest-framework"></a> DRF（django rest framework）</h2>
<p>简述DRF（Django restframework）就是一个Django中使用 rest 接口规范的模块。什么rest接口规范？就是对于我们书写前后端分离时，定义接口的一种规范，列举如下规范：</p>
<table>
<thead>
<tr>
<th style="text-align:center">请求方式</th>
<th style="text-align:center">url 设计（接口）</th>
<th style="text-align:center">请求内容</th>
<th style="text-align:center">响应内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">127.0.0.1:8000/books/</td>
<td style="text-align:center">获取所有书本的信息</td>
<td style="text-align:center">[ {书的id,name,…} , {}, {} …]</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">127.0.0.1:8000/books/{ id }</td>
<td style="text-align:center">获取单条数据据</td>
<td style="text-align:center">单条数据{ 书的 id，name…. }</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">127.0.0.1:8000/books/</td>
<td style="text-align:center">增加单条数据</td>
<td style="text-align:center">添加成功的数据{ ‘mesage’:‘ok’}</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">127.0.0.1：8000/books/{ id }</td>
<td style="text-align:center">删除单条数据</td>
<td style="text-align:center">返回空“  ”</td>
</tr>
<tr>
<td style="text-align:center">PUT</td>
<td style="text-align:center">127.0.0.1:8000/books/{ id }</td>
<td style="text-align:center">修改数据</td>
<td style="text-align:center">更新后完整的数据{ }</td>
</tr>
</tbody>
</table>
<p>从结构上看，比我们一般设计的 url 地址更加简洁明了，方便程序员维护还有错误处理</p>
<p>错误处理：{ “error” : “message” }</p>
<p>如何在 Django 中实现 rest接口规范？</p>
<p>安装 DRF</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br><span class="line">pip install djangorestframework</span><br></pre></td></tr></table></figure>
<p>完成之后可以进行学习了以下内容：</p>
<ul>
<li>APIView</li>
<li>解析器组件</li>
<li>序列化组件</li>
<li>视图组件</li>
<li>认证组件</li>
<li>权限组件</li>
<li>频率控制组件</li>
<li>分页组件</li>
<li>响应器组件</li>
<li>url 控制器</li>
</ul>
<p>Django 中View视图函数使用有些不是很方便，所以封装了APIView</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(request.POST)</span><br><span class="line">        <span class="comment"># 此时Ajax发送的请求无法被识别</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>APIView的使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">APIview</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="comment"># APIView中的解析器就帮我们做到了解析的功能</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>View源码分析CBV（django  classbasedview）</p>
<ol>
<li>
<p>from  django.views  import  View</p>
</li>
<li>
<p>在视图类种继承 View 类 class StudentView(View):pass</p>
</li>
<li>
<p><span class="exturl" data-url="aHR0cDovL3VybHMucHk=">urls.py<i class="fa fa-external-link-alt"></i></span> 中定义路由关系</p>
<ol>
<li>from django.urls  import  re_path<br />
from classbasedview  import views</li>
</ol>
<p>urlpatterns = [</p>
<p>​	re_path(“login/”, views.LoginView.as_view()),</p>
<p>]</p>
</li>
<li>
<p>Django启动时加载路由系统，会读取urlpatterns中的对应关系</p>
</li>
<li>
<p>执行as_view(),或得器返回值，该函数返回一个view视图函数</p>
</li>
<li>
<p>此时绑定关系建立好了，当用户请求过来时，就会执行url对应得view视图函数</p>
</li>
<li>
<p>该视图函数得返回值是self.dispatch()</p>
</li>
<li>
<p>self.dispatch()会找到http_method_names变量里面得函数，并执行，并最终返回</p>
</li>
</ol>
<p>APIView源码分析</p>
<p>封装自己的东西，用到view得方法</p>
<ol>
<li>
<p>安装djangorestframework<br />
pip install djangorestframework</p>
</li>
<li>
<p>在views.py中<br />
from rest_framework.view  import  APIView</p>
</li>
<li>
<p>在视图类继承APIView</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StudentView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
</li>
<li>
<p><span class="exturl" data-url="aHR0cDovL3VybHMucHk=">urls.py<i class="fa fa-external-link-alt"></i></span> 中保持不变</p>
</li>
<li>
<p>Django启动时加载路由系统，会读取 urlpatterns 中的对应关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> api.view <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&quot;login/&quot;</span>, views.LoginView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>此时绑定关系已经建立好了，当用户请求过来时，就会执行 url 对应的 View 视图函数</p>
</li>
<li>
<p>请求到来，执行View视图函数</p>
</li>
<li>
<p>最后执行 dispatch()，获取返回值，返回给用户</p>
</li>
<li>
<p>Django RestFramework 自定制的内容就在重写的 as_view 函数里面以及 dispatch() 方法</p>
</li>
</ol>
<h2 id="解析器组件"><a class="markdownIt-Anchor" href="#解析器组件"></a> 解析器组件</h2>
<p>Django 原生解析器</p>
<ol>
<li>from django.core.handlers.wsgi  import WSGIRequest</li>
<li>POST = property(_get_post, _set_post), 找 def  _load_post_and_files(self)函数，判断类型，然后进行解析封装。只支持  content_type == ‘multipart/from-data’ 。也可以进行自定义封装，但是遵循开放封闭原则，不要更改源代码。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(request.POST)</span><br><span class="line">        origin_data = request.body</span><br><span class="line">        parsed_data = origin_data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(parsed_data)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>DRF的解析器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.parsers <span class="keyword">import</span> FormParser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    parser_classes = [FormParser]</span><br><span class="line">    <span class="comment"># 此时加了固定的解析器，就只能解析formdata了</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># print(request.POST)</span></span><br><span class="line">        <span class="comment"># origin_data = request.body</span></span><br><span class="line">        <span class="comment"># parsed_data = origin_data.decode(&#x27;utf-8&#x27;)</span></span><br><span class="line">        <span class="comment"># print(parsed_data)</span></span><br><span class="line">        <span class="built_in">print</span>(request.data)</span><br><span class="line">        <span class="comment"># request.data 是一个函数，一个 porperty 装饰的方法</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>
<p>views.LoginView.as_view()</p>
</li>
<li>
<p>LoginView 里面没有 as_view 方法，到父类 APIView 去找</p>
</li>
<li>
<p>执行 View 里面得 as_view() 方法，返回函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">    self = cls(**initkwargs)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;get&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;head&#x27;</span>):</span><br><span class="line">        self.head = self.get</span><br><span class="line">    self.request = request</span><br><span class="line">    self.args = args</span><br><span class="line">    self.kwargs = kwargs</span><br><span class="line">    <span class="keyword">return</span> self.dispatch()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>url 和视图函数之间得绑定关系建立完毕 <code>&#123;&quot;login&quot;: view&#125;,</code> 等待用户请求</p>
</li>
<li>
<p>接受到用户请i去：login，到建立好的绑定关系里面执行对应得视图函数：view(request)</p>
</li>
<li>
<p>视图函数的执行结构是什么就返回给用户什么：self.dispatch()，self.diaptch() 的执行结果是什么，就返回给用户是什么</p>
</li>
<li>
<p>此时的 self 代表的就是 LoginView 对象</p>
</li>
<li>
<p>开始找 dispatch 方法，self里面没有，LoginView里面没有，在APIView里面有</p>
</li>
<li>
<p>开始执行 APIView 里面的 dispatch</p>
</li>
<li>
<p>最后找到 http 方法（GET，POST，PUT，DELETE）</p>
</li>
<li>
<p>开始执行找到的方法（GET），self.get(), self此时代表LoginView的实例化对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11.1</span> 假设接收到的是POST请求, 执行request.data</span><br><span class="line"><span class="number">11.2</span> 根据分析，所有的解析工作都在request.data里面实现，且data是一个方法（被装饰后的）</span><br><span class="line"><span class="number">11.2</span> 开始执行request.data</span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">data</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> _<span class="built_in">hasattr</span>(self, <span class="string">&#x27;_full_data&#x27;</span>):</span><br><span class="line">			self._load_data_and_files()</span><br><span class="line">		<span class="keyword">return</span> self._full_data</span><br><span class="line"><span class="number">11.3</span> 执行self._load_data_and_files</span><br><span class="line"><span class="number">11.4</span> 执行self._data, self._files = self._parse()</span><br><span class="line"><span class="number">11.5</span> parser = self.negotiator.select_parser(self, self.parsers)</span><br><span class="line">	<span class="number">11.5</span><span class="number">.1</span> 开始找self.parsers</span><br><span class="line">	<span class="number">11.5</span><span class="number">.2</span> self.get_parses()</span><br><span class="line">			[ parse() <span class="keyword">for</span> parse <span class="keyword">in</span> self.parser_classes ]</span><br><span class="line">		<span class="number">11.5</span><span class="number">.3</span> parser_classes = api_settings.DEFAULT_PARSER_CLASSES</span><br><span class="line">		<span class="number">11.5</span><span class="number">.4</span> <span class="keyword">from</span> rest_framework <span class="keyword">import</span> api_settings</span><br><span class="line">		<span class="number">11.5</span><span class="number">.5</span> api_settings = APISettings(<span class="literal">None</span>, DEFAULTS, IMPORT_STRINGS)</span><br><span class="line">	<span class="number">11.5</span><span class="number">.6</span> <span class="keyword">class</span> <span class="title class_">APISettings</span>():<span class="keyword">pass</span></span><br><span class="line">	<span class="number">11.5</span><span class="number">.7</span> 找不到DEFAULT_PARSER_CLASSES，__getattr__</span><br><span class="line">		<span class="string">&#x27;DEFAULT_PARSER_CLASSES&#x27;</span>: (</span><br><span class="line">		<span class="string">&#x27;rest_framework.parsers.JSONParser&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;rest_framework.parsers.FormParser&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;rest_framework.parsers.MultiPartParser&#x27;</span></span><br><span class="line">	),</span><br><span class="line">	<span class="number">11.5</span><span class="number">.8</span> 首先找程序的settings</span><br><span class="line">	<span class="number">11.5</span><span class="number">.9</span> 然后找rest_framework的settings</span><br><span class="line"></span><br><span class="line"><span class="number">11.6</span> self._data就是我们想要的数据</span><br><span class="line"><span class="number">11.7</span> DRF将self._data = data</span><br><span class="line"><span class="number">11.8</span> request.data</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>DRF的所有功能都是在as_view() 和 dispatch里面重写的</p>
<p>而解析器组件在 dispatch 方法里面重写了，具体是在重新封装的Request对象里面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  源码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">	    <span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">		request.data  <span class="comment"># 新的request对象 @property</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls, **initkwargs</span>):</span><br><span class="line">	    <span class="keyword">pass</span></span><br><span class="line">		<span class="built_in">super</span>(APIView, cls).as_view(**initkwargs)</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">initialize_request</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Request(</span><br><span class="line">			request,  <span class="comment"># 原生request对象</span></span><br><span class="line">			parsers=self.get_parsers(), <span class="comment">#</span></span><br><span class="line">			authenticators=self.get_authenticators(),</span><br><span class="line">			negotiator=self.get_content_negotiator(),</span><br><span class="line">			parser_context=parser_context</span><br><span class="line">		)</span><br><span class="line">			</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self</span>):</span><br><span class="line">	    <span class="keyword">pass</span></span><br><span class="line">		request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        self.request = request</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">get_parsers</span>(<span class="params">self</span>):</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> [parser() <span class="keyword">for</span> parser <span class="keyword">in</span> self.parser_classes]</span><br></pre></td></tr></table></figure>
<p>Django 的原生序列化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.serializers <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CourseView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="comment"># def get(self, request):</span></span><br><span class="line">    <span class="comment">#     course_list = list()</span></span><br><span class="line">    <span class="comment">#     for course in Course.objects.all():</span></span><br><span class="line">    <span class="comment">#         course = &#123;</span></span><br><span class="line">    <span class="comment">#             &quot;course_name&quot;: course.course_name,</span></span><br><span class="line">    <span class="comment">#             &quot;description&quot;: course.description,</span></span><br><span class="line">    <span class="comment">#         &#125;</span></span><br><span class="line">    <span class="comment">#         course_list.append(course)</span></span><br><span class="line">    <span class="comment">#     print(course_list)</span></span><br><span class="line">    <span class="comment">#     return HttpResponse(json.dumps(course_list, ensure_ascii=False))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        origin_data = Course.objects.<span class="built_in">all</span>()</span><br><span class="line">        <span class="comment"># 开始序列化</span></span><br><span class="line">        serialized_data = serialize(<span class="string">&quot;json&quot;</span>, origin_data)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(serialized_data)</span><br></pre></td></tr></table></figure>
<h3 id="drf序列化"><a class="markdownIt-Anchor" href="#drf序列化"></a> DRF序列化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line"></span><br><span class="line">    publish_name = serializers.CharField(max_length=<span class="number">32</span>, read_only=<span class="literal">True</span>, source=<span class="string">&quot;publish.name&quot;</span>)</span><br><span class="line">    publish_city = serializers.CharField(max_length=<span class="number">32</span>, read_only=<span class="literal">True</span>, source=<span class="string">&quot;publish.city&quot;</span>)</span><br><span class="line">    <span class="comment"># write_only_fields = (&quot;authors&quot;, &quot;publish&quot;)</span></span><br><span class="line"></span><br><span class="line">    author_list = serializers.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_author_list</span>(<span class="params">self, book_obj</span>):</span><br><span class="line">        <span class="comment"># 拿到 queryset 开始循环 [&#123;&#125;,&#123;&#125;,&#123;&#125;]</span></span><br><span class="line">        authors = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> author <span class="keyword">in</span> book_obj.authors.<span class="built_in">all</span>():</span><br><span class="line">            authors.append(author.name)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> authors</span><br></pre></td></tr></table></figure>
<h3 id="mixins-进行接口优化"><a class="markdownIt-Anchor" href="#mixins-进行接口优化"></a> Mixins 进行接口优化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> (ListModelMixin,</span><br><span class="line">                                   CreateModelMixin,</span><br><span class="line">                                   DestroyModelMixin,</span><br><span class="line">                                   UpdateModelMixin,</span><br><span class="line">                                   RetrieveModelMixin)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .app_serializer <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(ListModelMixin, CreateModelMixin, GenericAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>() </span><br><span class="line">    <span class="comment"># 告诉需要使用的数据库查询</span></span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line">	<span class="comment"># 告诉使用的序列化组件</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookFilterView</span>(DestroyModelMixin, UpdateModelMixin, RetrieveModelMixin, GenericAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>
<ul>
<li>Django程序启动，开始初始化，读取 <span class="exturl" data-url="aHR0cDovL3VybHMucHk=">urls.py<i class="fa fa-external-link-alt"></i></span>， 读取 settings， 读取视图类</li>
<li>执行 as_view()，BookView没有，需要到父类中找</li>
<li>几个ModelMixin也没有，GenericAPIView中没有，继续到GenericAPIView（APIView）中找</li>
<li>在APIView中找到，与前面的逻辑一样，在 GenericAPIview 中定义了查找 queryset 和serializer——class 类的方法</li>
<li>as_view() 方法返回重新封装的视图函数，开始建立 url 和视图函数之间的映射关系</li>
<li>等待用户请求</li>
<li>执行视图函数的 dispatch 方法（因为视图函数的返回值是：return self.dispatch()</li>
<li>dispatch 分发请求，查找到视图类的五个方法中的某个</li>
<li>开始执行，例如 post 请求，返回 self.create()， 自己没有，去父类找。</li>
<li>最后在 CreateModelMixin 中查找</li>
<li>执行 create()  方法，获取 queryset 和 serializer_class</li>
<li>返回数据</li>
</ul>
<p>断言进行判断</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>  a <span class="keyword">in</span> b </span><br><span class="line"><span class="comment"># assert 就是断言</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-generics-进行接口逻辑优化"><a class="markdownIt-Anchor" href="#使用-generics-进行接口逻辑优化"></a> 使用 generics 进行接口逻辑优化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(generics.ListCreateAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookFilterView</span>(generics.RetrieveUpdateDestroyAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用viewset进行接口逻辑优化"><a class="markdownIt-Anchor" href="#使用viewset进行接口逻辑优化"></a> 使用viewset进行接口逻辑优化</h3>
<p>对比上面，再次封装（不是我），利用 mixins 进行分发请求，找到对应的函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>与上面一样加载后，进行 as_view() 函数中，因为路由中配置了参数，携带 actions参数 到函数中执行</p>
</li>
<li>
<p>Django程序启动，开始与上述一样的操作</p>
</li>
<li>
<p>遵循自己没有，找父类，找到了ModelViewSet 中找</p>
</li>
<li>
<p>ModelViewSet 继承了 mixins 的几个 ModelMixin 和 GenericViewSet，最终只有GenericViewSet ，它继承了 ViewSetMixin 和 generic.GenericAPIView （这个我们已经认识了）</p>
</li>
<li>
<p>先去 ViewSetMixin 中查找，找到了 as_view() 类方法，在重新封装 view 函数的过程中，有一个 self.action_map = actions</p>
</li>
<li>
<p>这个 actions 就是我们给 as_view() 传递的参数</p>
</li>
<li>
<p>绑定 url 和视图函数（actions）之间的映射关系</p>
</li>
<li>
<p>等待用户请求</p>
</li>
<li>
<p>接收到用户请求，根据 url 找到视图函数</p>
</li>
<li>
<p>执行视图函数的 dispatch 方法（因为视图函数的返回值是： return self.dispatch()）</p>
</li>
<li>
<p>dispatch 分发请求，查找到视图类的五个方法的某个</p>
</li>
<li>
<p>开始执行，例如 post 请求，返回：self.creat(), 自己没有，去父类</p>
</li>
<li>
<p>最后找到 CreateModelMixin 中，执行create方法，获取queryset和serializer_class ，返回数据</p>
</li>
</ul>
<h2 id="django下的表contentype表"><a class="markdownIt-Anchor" href="#django下的表contentype表"></a> Django下的表contentype表：</h2>
<p>这张表主要记录</p>
<h2 id="公钥私钥"><a class="markdownIt-Anchor" href="#公钥私钥"></a> 公钥私钥</h2>
<p>私钥  ———— 公钥                      RSA</p>
<h2 id="支付宝沙箱环境"><a class="markdownIt-Anchor" href="#支付宝沙箱环境"></a> 支付宝沙箱环境</h2>
<p>getattr  （）</p>
<h2 id="django-admin源码"><a class="markdownIt-Anchor" href="#django-admin源码"></a> Django admin源码</h2>
<p>callable() ke’diao</p>
<h2 id="cookie和session区别"><a class="markdownIt-Anchor" href="#cookie和session区别"></a> Cookie和session区别</h2>
<p>Cookies 是服务器在本地机器的一个小文本，每一次都随着本地服务器发送至同一个服务器。 IETE RFC 2956 HTTP State Management Mechanism 是通用 cookie 规范。网络服务器用 HTTP头向客户端发送 Cookie，在客户端，浏览器通过解析这些 cookie 并将它们保存为一个本地文件，它会自动将同一服务器的任何请求带上这写 cookies。</p>
<p>Cookie 机制采用的是在客户端保持状态的方案。它是在用户端的会话状态的存贮机制，他需要用户打开客户端的 cookie 支持。cookie 的作用就是为了解决 HTTP 协议无状态的缺陷所作的努力。</p>
<h2 id="session"><a class="markdownIt-Anchor" href="#session"></a> session</h2>
<p>session 是一种服务端的机制，服务端使用类似于散列表的结构来保存信息。</p>
<p>当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含一个session 标识（session Id），如果已经为此客户端创建过 session ，服务器就按照这个 session Id 把session 减锁出来使用（无，则创建）。这个session Id 的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个 session ID 将被在被刺响应中返回给客户端保存。</p>
<p>保存这个session Id的方式可以采用 cookie， 这样在交互过程中浏览器可以自动的按照规则把这个 标识发挥给服务器。一般这个 cookie的名字类似于 session Id。但是 cookie可以被认为禁用。</p>
<p>有一个技术叫做 URL 重写， 就是 session Id 直接附加在 URL路径的后面， 还有一种技术叫做 表单隐藏字段。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把session Id 传递会服务器。</p>
<p>cookie 和seseion 都能够进行会话跟踪，但是完成原理不太一样，普通状况下二者均能满足需求，但是 有时不能够运用cookie ，有时不能够运用 session。</p>
<p>Cookie 和session的不同点：</p>
<p>1.存取方式不同<br />
Cookie 只能保管 ASCII 字符串，假如需求存取 Unicode 字符或则二进制数据，要先编码。若要存储略微复杂的信息，比较难。</p>
<p>session 中能够存储任何类型的数据，包括而不限于 string ，，，等。session 中能够直接保管 java Bean乃至任何Java类。</p>
<p>2.隐藏策略的不同</p>
<p>cookie 存储在客户端阅读器中，对客户端是可见的，客户端的一些程序可能会窥探、复制以至修正cookie中的内容。</p>
<p>而session 存储 在服务器上，对客户端是透明的，不存在敏感信息泄露的风险。</p>
<p>假如选用 cookie，比较好的方法是，敏感的信息如账号等尽量不要写到 cookie 中。最好将 cookie 信息加密，然后提交服务器解密。</p>
<p>3.有效期的不同</p>
<p>cookie 可以设置的时间很长很长，以持久的记载该用户的登录信息。要到达这种效果，用cookie是好的选择。</p>
<p>session 依赖于 名为 jseeion Id 的cookie，而 cookie 就sessionId的国企时间默许为 -1，值需关闭阅读器session就会失效，所以session 不能够达到持久的记录。运用 URL重写也不行。而 设置session的超时时间越长， 服务器累计的session就会越多，越容易招致内存泄漏。</p>
<p>4.服务器压力的不同</p>
<p>session 是保管在服务端的，每个用户都会产生一个session。假如并发访问的用户十分多，会产生十分多的 session， 耗费大量的内存。所以并发极高的情况，不会选择用session追踪客户会话。</p>
<p>而cookie保存在客户端，不占用服务器资源。并发阅读的用户十分多，cookie是很好的选择。</p>
<p>5.浏览器支持的不同</p>
<p>cookie 是需要客户端浏览器支持的。计入客户端仅用了 cookie，那么会话跟踪就会失效。关于 WAP 应用，常规的Cookie 就派不上用场了。</p>
<p>运用 session以及 URL地址重写。需要注意的是一切的用到 session 程序的 URL 都要进行 URL地址重写。否则 session会话跟踪还会失效。关于 WAP应用来说， session+URL地址重写或许是他唯一的选择。</p>
<p>假如支持 cookie，则 cookie既能够设为本浏览器窗口以及子窗口内有效，也能设为一切阅读器窗口内有效。但 session 只能在本阅读器窗口以及其子窗口内有效。但session只能在本阅读器内有效。（IE8下不同窗口session相干）</p>
<p>6.跨域支持上的不同</p>
<p>cookie 支持跨域名访问。例如将 domain 属性设置为 “.bao.com”，则以 “.bao.com”为后缀的一切域名能够访问 cookie。跨域名 cookie 如今被普遍用在网络中。而session不会支持跨域名访问，session仅在他所在的域名内有效。</p>
<p>所以大部分场景都是cookie和session搭配。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag"></i> 笔记</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/10/17/Mysql/" rel="prev" title="mysql 简单入门">
                  <i class="fa fa-angle-left"></i> mysql 简单入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/11/22/Linux/" rel="next" title="linux 基本认识">
                  linux 基本认识 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">genyuan</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9waXNjZXMv">NexT.Pisces</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dyb290LWd1bw==" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
